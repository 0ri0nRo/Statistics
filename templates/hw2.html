<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Random Walk - Multiple Simulations</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
            margin: 30px;
            background-color: #f9f9f9;
            color: #333;
        }

        h1, h2, h3 {
            color: #003366;
            margin-top: 20px;
            margin-bottom: 10px;
        }

        p {
            margin: 10px 0;
            text-align: justify;
        }

        code {
            background-color: #e0e0e0;
            padding: 2px 5px;
            border-radius: 3px;
        }

        .container {
            margin-top: 30px;
        }

        .input-group {
            margin: 10px 0;
        }

        label {
            display: inline-block;
            width: 150px;
        }

        input[type="number"] {
            width: 80px;
            padding: 5px;
        }

        button {
            padding: 10px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }

        button:hover {
            background-color: #45a049;
        }

        #plot-canvas,
        #mean-canvas,
        #variance-canvas,
        #freq-canvas {
            margin-top: 30px;
            border: 1px solid #ccc;
            max-width: 100%;
        }

        .graph-title {
            background-color: #4A90E2;
            color: white;
            padding: 10px;
            text-align: center;
            border-radius: 5px;
            margin-bottom: 10px;
            font-size: 24px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Random Walk - Multiple Simulations</h1>
    <h2>1. Random Walk Simulation with Multiple Paths</h2>
    <p>
        This simulation generates multiple random walks, each path representing a different trajectory.
        The steps of each random walk are drawn from a normal (Gaussian) distribution with mean 0 and variance 1.
    </p>

    <div class="container">
        <div class="input-group">
            <label for="steps">Number of Steps:</label>
            <input type="number" id="steps" value="100" min="10" max="1000">
        </div>
        <div class="input-group">
            <label for="paths">Number of Paths:</label>
            <input type="number" id="paths" value="10" min="1" max="100">
        </div>
        <div class="input-group">
            <label for="time-step">Time Step (Î”t):</label>
            <input type="number" id="time-step" value="0.01" min="0.001" max="1" step="0.001">
        </div>
        <div class="input-group">
            <label for="jump-prob">Jump Probability (p):</label>
            <input type="number" id="jump-prob" value="0.1" min="0.0" max="1.0" step="0.01">
        </div>
        <div class="input-group">
            <label for="freq-steps">Frequency Steps:</label>
            <input type="number" id="freq-steps" value="5" min="1" max="100">
        </div>
        <button id="run-simulation">Run Simulation</button>
    </div>

    <div id="results">
        <h2 class="graph-title">Simulation Output</h2>
        <canvas id="plot-canvas" width="800" height="400"></canvas>

        <h2 class="graph-title">Mean Trajectories</h2>
        <canvas id="mean-canvas" width="800" height="400"></canvas>

        <h2 class="graph-title">Variance Trajectories</h2>
        <canvas id="variance-canvas" width="800" height="400"></canvas>

        <h2 class="graph-title">Absolute Frequency Distribution</h2>
        <canvas id="freq-canvas" width="800" height="400"></canvas>

        <button id="downloadBtn" style="display: none;">Download Results</button>
    </div>

    <script>
        const canvas = document.getElementById('plot-canvas');
        const meanCanvas = document.getElementById('mean-canvas');
        const varianceCanvas = document.getElementById('variance-canvas');
        const freqCanvas = document.getElementById('freq-canvas');
        const ctx = canvas.getContext('2d');
        const meanCtx = meanCanvas.getContext('2d');
        const varianceCtx = varianceCanvas.getContext('2d');
        const freqCtx = freqCanvas.getContext('2d');
        const runSimulationButton = document.getElementById('run-simulation');
        const downloadButton = document.getElementById('downloadBtn');

        function gaussianRandom(mean = 0, stdev = 1) {
            let u = 1 - Math.random();
            let v = Math.random();
            let z = Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);
            return z * stdev + mean;
        }

        function randomJump(p) {
            return Math.random() < p ? (Math.random() < 0.5 ? -1 : 1) : 0;
        }

        function simulateRandomWalk(steps, dt, numPaths, jumpProb) {
            let paths = [];
            let means = new Array(steps + 1).fill(0);
            let variances = new Array(steps + 1).fill(0);
            let counts = new Array(steps + 1).fill(0);
            let freqCount = new Array(steps + 1).fill(0).map(() => ({}));

            for (let j = 0; j < numPaths; j++) {
                let path = [0];
                for (let i = 1; i <= steps; i++) {
                    const gaussianStep = gaussianRandom(0, Math.sqrt(dt));
                    const jump = randomJump(jumpProb);
                    path.push(path[i - 1] + gaussianStep + jump);

                    counts[i]++;
                    const delta = path[i] - means[i];
                    means[i] += delta / counts[i];
                    const delta2 = path[i] - means[i];
                    variances[i] += delta * delta2;

                    // Track frequency
                    const pos = Math.round(path[i]);
                    freqCount[i][pos] = (freqCount[i][pos] || 0) + 1;
                }
                paths.push(path);
            }

            for (let i = 1; i <= steps; i++) {
                variances[i] = variances[i] / (counts[i] - 1);
            }

            return { paths, means, variances, freqCount };
        }

        function drawAxes(ctx, width, height, steps, maxY, labelX, labelY) {
            const margin = 40;
            ctx.strokeStyle = 'black';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(margin, 0);
            ctx.lineTo(margin, height - margin);
            ctx.lineTo(width, height - margin);
            ctx.stroke();

            ctx.font = '12px Arial';
            ctx.fillStyle = 'black';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';

            for (let i = 0; i <= steps; i += Math.floor(steps / 10)) {
                const x = margin + (i / steps) * (width - margin);
                ctx.fillText(i, x, height - margin + 15);
            }

            for (let j = 0; j <= 5; j++) {
                const y = height - margin - (j / 5) * (height - margin);
                ctx.fillText((j * maxY / 5).toFixed(2), margin - 25, y);
            }

            ctx.fillText(labelX, width / 2, height - 10);
            ctx.save();
            ctx.translate(10, height / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText(labelY, 0, 0);
            ctx.restore();
        }

        function plotPaths(paths) {
            const height = canvas.height;
            const width = canvas.width;
            const maxY = Math.max(...paths.flat());
            ctx.clearRect(0, 0, width, height);
            drawAxes(ctx, width, height, paths[0].length - 1, maxY, 'Steps', 'Position');

            ctx.lineWidth = 1;
            for (let i = 0; i < paths.length; i++) {
                ctx.beginPath();
                for (let j = 0; j < paths[i].length; j++) {
                    const x = j * (width - 40) / (paths[i].length - 1) + 40;
                    const y = height - ((paths[i][j] / maxY) * (height - 40) + 40);
                    ctx.lineTo(x, y);
                }
                ctx.strokeStyle = 'rgba(70,130,180, 0.7)';
                ctx.stroke();
            }
        }

        function plotMean(means) {
            const height = meanCanvas.height;
            const width = meanCanvas.width;
            const maxY = Math.max(...means);
            meanCtx.clearRect(0, 0, width, height);
            drawAxes(meanCtx, width, height, means.length - 1, maxY, 'Steps', 'Mean Position');

            meanCtx.lineWidth = 2;
            meanCtx.beginPath();
            for (let i = 0; i < means.length; i++) {
                const x = i * (width - 40) / (means.length - 1) + 40;
                const y = height - ((means[i] / maxY) * (height - 40) + 40);
                meanCtx.lineTo(x, y);
            }
            meanCtx.strokeStyle = 'rgba(34,139,34, 1)';
            meanCtx.stroke();
        }

        function plotVariance(variances) {
            const height = varianceCanvas.height;
            const width = varianceCanvas.width;
            const maxY = Math.max(...variances);
            varianceCtx.clearRect(0, 0, width, height);
            drawAxes(varianceCtx, width, height, variances.length - 1, maxY, 'Steps', 'Variance');

            varianceCtx.lineWidth = 2;
            varianceCtx.beginPath();
            for (let i = 0; i < variances.length; i++) {
                const x = i * (width - 40) / (variances.length - 1) + 40;
                const y = height - ((variances[i] / maxY) * (height - 40) + 40);
                varianceCtx.lineTo(x, y);
            }
            varianceCtx.strokeStyle = 'rgba(255,165,0, 1)';
            varianceCtx.stroke();
        }

        function plotFrequency(freqCount, freqSteps) {
            const height = freqCanvas.height;
            const width = freqCanvas.width;
            freqCtx.clearRect(0, 0, width, height);
            drawAxes(freqCtx, width, height, freqCount.length - 1, Math.max(...freqCount.flat()), 'Steps', 'Frequency');

            freqCtx.lineWidth = 2;
            for (let i = 1; i < freqCount.length; i++) {
                const totalFreq = Object.values(freqCount[i]).reduce((a, b) => a + b, 0);
                for (let position in freqCount[i]) {
                    const frequency = freqCount[i][position];
                    const x = i * (width - 40) / (freqCount.length - 1) + 40;
                    const y = height - ((frequency / totalFreq) * (height - 40) + 40);
                    freqCtx.fillStyle = 'rgba(255,20,147, 0.7)';
                    freqCtx.fillRect(x - 2, y, 4, height - y - 40);
                }
            }
        }

        runSimulationButton.onclick = function () {
            const steps = parseInt(document.getElementById('steps').value);
            const paths = parseInt(document.getElementById('paths').value);
            const timeStep = parseFloat(document.getElementById('time-step').value);
            const jumpProb = parseFloat(document.getElementById('jump-prob').value);
            const freqSteps = parseInt(document.getElementById('freq-steps').value);

            const { paths: simulatedPaths, means, variances, freqCount } = simulateRandomWalk(steps, timeStep, paths, jumpProb);
            plotPaths(simulatedPaths);
            plotMean(means);
            plotVariance(variances);
            plotFrequency(freqCount, freqSteps);
        };
    </script>
</body>
</html>
