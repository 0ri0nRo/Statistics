<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Random Walk - Multiple Simulations</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
            margin: 20px;
            background-color: #f9f9f9;
            color: #333;
        }

        h1,
        h2,
        h3 {
            color: #003366;
            margin-top: 20px;
            margin-bottom: 10px;
        }

        p {
            margin: 10px 0;
            text-align: justify;
        }

        code {
            background-color: #e0e0e0;
            padding: 2px 5px;
            border-radius: 3px;
        }

        .container {
            margin-top: 20px;
        }

        .input-group {
            margin: 10px 0;
        }

        label {
            display: inline-block;
            width: 150px;
        }

        input[type="number"] {
            width: 80px;
            padding: 5px;
        }

        button {
            padding: 10px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }

        button:hover {
            background-color: #45a049;
        }

        #plot-canvas {
            margin-top: 20px;
            border: 1px solid #ccc;
        }

        .graph-title {
            background-color: #4A90E2;
            color: white;
            padding: 10px;
            text-align: center;
            border-radius: 5px;
            margin-bottom: 10px;
            font-size: 24px;
            font-weight: bold;
        }

        .results {
            margin-top: 20px;
        }
    </style>
</head>

<body>

    <h1>Random Walk - Multiple Simulations</h1>
    <h2>1. Random Walk Simulation with Multiple Paths</h2>
    <p>
        This simulation generates multiple random walks, each path representing a different trajectory.
        The steps of each random walk are drawn from a normal (Gaussian) distribution with mean 0 and variance 1.
    </p>

    <div class="container">
        <div class="input-group">
            <label for="steps">Number of Steps:</label>
            <input type="number" id="steps" value="100" min="10" max="1000">
        </div>
        <div class="input-group">
            <label for="paths">Number of Paths:</label>
            <input type="number" id="paths" value="10" min="1" max="100">
        </div>
        <div class="input-group">
            <label for="time-step">Time Step (Δt):</label>
            <input type="number" id="time-step" value="0.01" min="0.001" max="1" step="0.001">
        </div>
        <div class="input-group">
            <label for="jump-prob">Jump Probability (p):</label>
            <input type="number" id="jump-prob" value="0.1" min="0.0" max="1.0" step="0.01">
        </div>
        <div class="input-group">
            <label for="freq-interval">Frequency Interval:</label>
            <input type="number" id="freq-interval" value="10" min="1" max="100">
        </div>
        <button id="run-simulation">Run Simulation</button>
    </div>

    <div id="results">
        <h2 class="graph-title">Simulation Output</h2>
        <canvas id="plot-canvas" width="800" height="400"></canvas>
        <div class="results">
            <h3>Mean and Variance:</h3>
            <p id="mean-result"></p>
            <p id="variance-result"></p>
        </div>
        <button id="downloadBtn" style="display: none;">Download Results</button>
    </div>

    <script>
        const canvas = document.getElementById('plot-canvas');
        const ctx = canvas.getContext('2d');
        const runSimulationButton = document.getElementById('run-simulation');
        const downloadButton = document.getElementById('downloadBtn');
        const meanResult = document.getElementById('mean-result');
        const varianceResult = document.getElementById('variance-result');

        // Function to generate random numbers from a Gaussian (normal) distribution
        function gaussianRandom(mean = 0, stdev = 1) {
            let u = 1 - Math.random(); // Subtraction to avoid log(0)
            let v = Math.random();
            let z = Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);
            return z * stdev + mean;
        }

        // Function to simulate jumps
        function randomJump(p) {
            return Math.random() < p ? (Math.random() < 0.5 ? -1 : 1) : 0; // -1 or +1 with probability p
        }

        // Random walk simulation with Gaussian distribution steps for multiple paths
        function simulateRandomWalk(steps, dt, numPaths, jumpProb) {
            let paths = [];
            let means = new Array(numPaths).fill(0);
            let variances = new Array(numPaths).fill(0);
            let counts = new Array(numPaths).fill(0);

            // Simulate multiple random walks
            for (let j = 0; j < numPaths; j++) {
                let path = [0];  // Initial value for each path
                for (let i = 1; i <= steps; i++) {
                    const gaussianStep = gaussianRandom(0, Math.sqrt(dt)); // Step with variance √dt
                    const jump = randomJump(jumpProb); // Step from random jump
                    path.push(path[i - 1] + gaussianStep + jump);
                    
                    // Welford's recursion for mean and variance
                    counts[j]++;
                    const delta = path[i] - means[j];
                    means[j] += delta / counts[j];
                    const delta2 = path[i] - means[j];
                    variances[j] += delta * delta2;
                }
                paths.push(path);
            }

            // Calculate final mean and variance
            const finalMeans = means.map(m => m);
            const finalVariances = variances.map(v => v / (counts[0] - 1));

            // Update the displayed results
            meanResult.innerText = `Means: ${finalMeans.join(", ")}`;
            varianceResult.innerText = `Variances: ${finalVariances.join(", ")}`;

            return paths;
        }

        // Plot the simulation results
        function plotResults(paths, steps) {
            const width = canvas.width;
            const height = canvas.height;
            const stepWidth = width / steps;

            ctx.clearRect(0, 0, width, height);
            ctx.fillStyle = "white";
            ctx.fillRect(0, 0, width, height);

            // Colors for different paths
            const colors = ['red', 'green', 'blue', 'purple', 'orange', 'pink', 'cyan', 'magenta'];

            paths.forEach((path, index) => {
                const color = colors[index % colors.length];
                ctx.strokeStyle = color;
                ctx.lineWidth = 1.5;

                ctx.beginPath();
                ctx.moveTo(0, height / 2);
                for (let i = 0; i < path.length; i++) {
                    const x = i * stepWidth;
                    const y = (height / 2) - path[i] * (height / 10); // Adjust scaling
                    ctx.lineTo(x, y);
                }
                ctx.stroke();
            });

            // Show download button
            downloadButton.style.display = 'block';
        }

        runSimulationButton.addEventListener('click', function () {
            const steps = parseInt(document.getElementById('steps').value);
            const numPaths = parseInt(document.getElementById('paths').value);
            const dt = parseFloat(document.getElementById('time-step').value);
            const jumpProb = parseFloat(document.getElementById('jump-prob').value);

            // Run the random walk simulation for multiple paths
            const paths = simulateRandomWalk(steps, dt, numPaths, jumpProb);

            // Plot the results
            plotResults(paths, steps);
        });

        // Download the graph as an image
        downloadButton.addEventListener('click', function () {
            const link = document.createElement('a');
            link.download = 'random_walk_simulation.png';
            link.href = canvas.toDataURL();
            link.click();
        });
    </script>

</body>
</html>
